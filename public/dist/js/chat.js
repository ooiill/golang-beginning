/*!  */
/*! beginning - 1.0.0 - 2021-05-06 */
"use strict";bsw.configure({data:{form:null,ws:null,nickname:null,token:null,userId:null,online:0,chat:null,chatHistory:[]},method:{inputNickname:function(){var a=prompt("请输入你的昵称");return null==a||0===a.length?this.inputNickname():a},doChat:function(a){a.preventDefault();var b=this;null!=b.chat&&0!==b.chat.length&&(b.ws.send(JSON.stringify({Authorization:b.token,Behavior:"chat",Arguments:{message:b.chat},Time:Math.floor((new Date).getTime()/1e3)})),b.chat=null)}},logic:{initForm:function(a){a.form=a.$form.createForm(a)},ws:function ws(v){v.nickname=v.inputNickname(),v.ws=new ReconnectingWebSocket("ws://"+window.location.host+"/ws/chat"),v.ws.onopen=function(){console.log("成功连接服务器。"),v.ws.send(JSON.stringify({Behavior:"register",Arguments:{nickname:v.nickname}}))},v.ws.onclose=function(){console.log("收到关闭请求，成功断开连接。")},v.ws.onmessage=function(msg){var response=eval("("+msg.data+")");if(console.log("收到消息",response),"register"===response.Behavior){var _ref=[response.Arguments.token,response.Arguments.user_id];v.token=_ref[0],v.userId=_ref[1]}else"online"===response.Behavior?v.chatHistory.push({pOnlineClass:!0,bText:response.Arguments.nickname+" 上线了"}):"offline"===response.Behavior?v.chatHistory.push({pOfflineClass:!0,bText:response.Arguments.nickname+" 下线了"}):"chat"===response.Behavior&&v.chatHistory.push({bText:response.Arguments.time,pText:response.Arguments.from+": "+response.Arguments.message});"undefined"!=typeof response.Arguments.online&&(v.online=response.Arguments.online);var chatDiv=$("div#chat");chatDiv.animate({scrollTop:chatDiv.prop("scrollHeight")},200)}}}});